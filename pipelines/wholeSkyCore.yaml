description: |
  Tier1 plots and metrics to assess the data quality across the whole sky
parameters:
  objectTableCoreKeysWithBand: [
    "e1Diff_{band}_highSNStars_median",
    "e1Diff_{band}_highSNStars_sigmaMad",
    "e1Diff_{band}_lowSNStars_median",
    "e1Diff_{band}_lowSNStars_sigmaMad",
    "e2Diff_{band}_highSNStars_median",
    "e2Diff_{band}_highSNStars_sigmaMad",
    "e2Diff_{band}_lowSNStars_median",
    "e2Diff_{band}_lowSNStars_sigmaMad",
    "psfCModelScatter_{band}_psf_cModel_diff_median",
    "psfCModelScatter_{band}_psf_cModel_diff_sigmaMad",
    "psfCModelScatter_{band}_psf_cModel_diff_mean",
    "shapeSizeFractionalDiff_{band}_highSNStars_median",
    "shapeSizeFractionalDiff_{band}_highSNStars_sigmaMad",
    "shapeSizeFractionalDiff_{band}_lowSNStars_median",
    "shapeSizeFractionalDiff_{band}_lowSNStars_sigmaMad",
    "skyFluxStatisticMetric_{band}_medianSky",
    "skyFluxStatisticMetric_{band}_meanSky",
    "skyFluxStatisticMetric_{band}_stdevSky",
    "skyFluxStatisticMetric_{band}_sigmaMADSky",
  ]
  objectTableCorePlotKeys: [
    "wPerpPSFP_wPerp_psfFlux_median",
    "wPerpPSFP_wPerp_psfFlux_sigmaMAD",
    "yPerpPSF_yPerp_psfFlux_median",
    "yPerpPSF_yPerp_psfFlux_sigmaMAD",
    "skippedDeblenderMetrics_numSkippedPeaks",
    "skippedDeblenderMetrics_numSkippedBlends",
    "skippedDeblenderMetrics_numBlendParentTooBig",
    "skippedDeblenderMetrics_numBlendTooManyPeaks",
    "skippedDeblenderMetrics_numBlendTooManyMasked",
  ]
  objectTableCoreRefCatMatchKeysWithBand: [
    "astromDiffMetrics_AA1_RA_coadd",
    "astromDiffMetrics_AA1_sigmaMad_RA_coadd",
    "astromDiffMetrics_AA1_Dec_coadd",
    "astromDiffMetrics_AA1_sigmaMad_Dec_coadd",
    "astromDiffMetrics_AA1_tot_coadd",
    "astromDiffMetrics_AA1_sigmaMad_tot_coadd",
  ]
  matchedVisitCoreKeysWithBand: [
    "stellarAstrometricRepeatability1_{band}_AM1",
    "stellarAstrometricRepeatability1_{band}_AF1",
    "stellarAstrometricRepeatability1_{band}_AD1",
    "stellarAstrometricRepeatability2_{band}_AM2",
    "stellarAstrometricRepeatability2_{band}_AF2",
    "stellarAstrometricRepeatability2_{band}_AD2",
    "stellarAstrometricRepeatability3_{band}_AM3",
    "stellarAstrometricRepeatability3_{band}_AF3",
    "stellarAstrometricRepeatability3_{band}_AD3",
    "stellarAstrometricSelfRepeatabilityDec_{band}_dmL2AstroErr_Dec",
    "stellarAstrometricSelfRepeatabilityRA_{band}_dmL2AstroErr_RA",
    "stellarPhotometricRepeatability_{band}_stellarPhotRepeatStdev",
    "stellarPhotometricRepeatability_{band}_stellarPhotRepeatOutlierFraction",
    "stellarPhotometricResiduals_{band}_photResidTractSigmaMad",
    "stellarPhotometricResiduals_{band}_photResidTractStdev",
    "stellarPhotometricResiduals_{band}_photResidTractMedian",
  ]
tasks:
  makeMetricTableObjectTableCore:
    class: lsst.analysis.tools.tasks.MakeMetricTableTask
    config:
      python: |
        from lsst.analysis.tools.atools import *
  objectTableCoreWholeSkyPlot:
    class: lsst.analysis.tools.tasks.WholeSkyAnalysisTask
    config:
      atools.wholeSkyMetric: WholeSkyPlotTool
      atools.wholeSkyMetric.plotKeys: parameters.objectTableCorePlotKeys
      atools.wholeSkyMetric.keysWithBand: parameters.objectTableCoreKeysWithBand
      python: |
        from lsst.analysis.tools.atools import *
  # objectTableCoreWholeSkyPlot2:
  #   class: lsst.analysis.tools.tasks.WholeSkyAnalysisTask
  #   config:
  #     atools.wholeSkyMetric: WholeSkyPlotTool
  #     #atools.wholeSkyMetric.parameterizedBand: True
  #     atools.wholeSkyMetric.plotKeys: parameters.objectTableCorePlotKeys
  #     atools.wholeSkyMetric.keysWithBand: [] # parameters.objectTableCoreKeysWithBand
  #     python: |
  #       from lsst.analysis.tools.atools import *
  makeMetricTableObjectTableCoreRefCatMatch:
    class: lsst.analysis.tools.tasks.MakeMetricTableTask
    config:
      connections.metricBundleName: objectTable_tract_gaia_dr3_20230707_match_astrom_metrics
      python: |
        from lsst.analysis.tools.atools import *
  objectTableCoreRefCatMatchWholeSkyPlot:
    class: lsst.analysis.tools.tasks.WholeSkyAnalysisTask
    config:
      connections.inputName: "objectTable_tract_gaia_dr3_20230707_match_astrom_metricsTable"
      connections.outputName: "objectTableCoreRefCatMatch_wholeSky"
      atools.wholeSkyMetric: WholeSkyPlotTool
      atools.wholeSkyMetric.plotKeys: parameters.objectTableCoreRefCatMatchKeysWithBand
      atools.wholeSkyMetric.keysWithBand: []
      python: |
        from lsst.analysis.tools.atools import *
  makeMetricTableMatchedVisitCore:
    class: lsst.analysis.tools.tasks.MakeMetricTableTask
    config:
      connections.metricBundleName: "matchedVisitCore_metrics"
      loadMatchedVisitData: true
      python: |
        from lsst.analysis.tools.atools import *
  matchedVisitCoreWholeSkyPlot:
    class: lsst.analysis.tools.tasks.WholeSkyAnalysisTask
    config:
      connections.inputName: "matchedVisitCore_metricsTable"
      connections.outputName: "matchedVisitCore_wholeSky"
      atools.wholeSkyMetric: WholeSkyPlotTool
      atools.wholeSkyMetric.plotKeys: []
      atools.wholeSkyMetric.keysWithBand: parameters.matchedVisitCoreKeysWithBand
      python: |
        from lsst.analysis.tools.atools import *
